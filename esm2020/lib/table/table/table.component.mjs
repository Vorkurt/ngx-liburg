import { animate, state, style, transition, trigger } from '@angular/animations';
import { moveItemInArray } from "@angular/cdk/drag-drop";
import { Component, ContentChildren, EventEmitter, Input, Output, ViewChild, ViewEncapsulation } from '@angular/core';
import { MatPaginator } from '@angular/material/paginator';
import { MatTable } from '@angular/material/table';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { BaseColumn } from '../base-column';
import * as i0 from "@angular/core";
import * as i1 from "./table.service";
import * as i2 from "../columns/service/column-rotate.service";
import * as i3 from "@angular/common";
import * as i4 from "@angular/material/icon";
import * as i5 from "@angular/material/table";
import * as i6 from "@angular/material/paginator";
import * as i7 from "@angular/cdk/drag-drop";
export class TableComponent {
    constructor(_tableState, _columnRotate, _changeDetectorRef) {
        this._tableState = _tableState;
        this._columnRotate = _columnRotate;
        this._changeDetectorRef = _changeDetectorRef;
        this.extensible = false;
        // Footer
        this.footerShow = false;
        // class for footer
        this.footerMessageClass = '';
        // flag about if we want to show pagination
        this.showPagination = false;
        this.addedNewEntry = false;
        this.onAddEntry = new EventEmitter();
        this.onPaginationChange = new EventEmitter();
        this.filterTooltip = true;
        this.columnsToDispaly = [];
        this.doubleColumnToDisplay = [];
        // for avoid memory leak
        this._destroyed = new Subject();
    }
    ngAfterViewInit() {
        this.columnsToDispaly = this.columnDefs.map((resp) => resp.columnDef.name);
        this.columnDefs
            .map((resp) => resp.columnDef)
            .forEach((rep) => this.table.addColumnDef(rep));
        this._columnRotate.rotate$.pipe(takeUntil(this._destroyed)).subscribe((side) => {
            if (side.includes('left')) {
                this.rotateColumn('left');
            }
            else {
                this.rotateColumn('right');
            }
        });
        try {
            const duplicate = this.columnsToDispaly.filter((columnDisplay, index, self) => index === self.findIndex((value) => value === columnDisplay));
            this.doubleColumnToDisplay = this.columnsToDispaly;
            this._setColumnForLayout();
            if (duplicate.length < this.columnsToDispaly.length) {
                throw new Error('You duplicate value what you want to display, Please look in definitions at columns');
            }
        }
        catch (err) {
            console.error(err);
        }
        this._changeDetectorRef.detectChanges();
    }
    addNewEntry() {
        this.onAddEntry.next(true);
    }
    changePage(event) {
        this.onPaginationChange.emit(event);
    }
    drop(event) {
        moveItemInArray(this.dataSource, event.previousIndex, event.currentIndex);
        this.table.renderRows();
    }
    rotateColumn(side) {
        if (side === 'left') {
            this._rotateLeft();
        }
        else {
            this._rotateRight();
        }
        this.columnsToDispaly = [...this.doubleColumnToDisplay.slice(0, this.columnsToDispaly.length - 1), 'action'];
    }
    _rotateLeft() {
        const intermediateColumn = this.doubleColumnToDisplay[0];
        this.doubleColumnToDisplay.forEach((column, index) => {
            this.doubleColumnToDisplay[index] = this.doubleColumnToDisplay[index + 1];
        });
        this.doubleColumnToDisplay[this.doubleColumnToDisplay.length - 1] = intermediateColumn;
        this._columnRotate.swapColumn(this.doubleColumnToDisplay);
    }
    _rotateRight() {
        const intermediateColumn = this.doubleColumnToDisplay[this.doubleColumnToDisplay.length - 2];
        for (let i = this.doubleColumnToDisplay.length - 2; i > 0; i--) {
            this.doubleColumnToDisplay[i] = this.doubleColumnToDisplay[i - 1];
        }
        this.doubleColumnToDisplay[0] = intermediateColumn;
    }
    _setColumnForLayout() {
        this._tableState.responsive(this.columnsToDispaly, this.doubleColumnToDisplay);
        this._tableState.columnDisplay$.pipe(takeUntil(this._destroyed)).subscribe(columns => {
            this.columnsToDispaly = columns;
        });
    }
    ngOnDestroy() {
        this._destroyed.next();
        this._destroyed.complete();
    }
}
TableComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.3.0", ngImport: i0, type: TableComponent, deps: [{ token: i1.TableService }, { token: i2.ColumnRotateService }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
TableComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.3.0", type: TableComponent, selector: "elix-table", inputs: { dataSource: "dataSource", extensible: "extensible", extandble$: "extandble$", footerShow: "footerShow", footerMessageClass: "footerMessageClass", newElementExtandble: "newElementExtandble", showPagination: "showPagination", lenghtPagination: "lenghtPagination", paginationClass: "paginationClass", addedNewEntry: "addedNewEntry", filterTooltip: "filterTooltip" }, outputs: { onAddEntry: "onAddEntry", onPaginationChange: "onPaginationChange" }, queries: [{ propertyName: "columnDefs", predicate: BaseColumn }], viewQueries: [{ propertyName: "table", first: true, predicate: MatTable, descendants: true, static: true }, { propertyName: "paginator", first: true, predicate: MatPaginator, descendants: true }], ngImport: i0, template: "<mat-table mat-table [dataSource]=\"dataSource\" multiTemplateDataRows=\"true\" cdkDropList [cdkDropListData]=\"dataSource\"\n           [ngStyle]=\"{'box-shadow': addedNewEntry ? 'none': ''}\"\n           (cdkDropListDropped)=\"drop($event)\">\n  <ng-content></ng-content>\n  <mat-header-row\n    class=\"header-color gap-1\"\n    mat-header-row\n    *matHeaderRowDef=\"columnsToDispaly; sticky: true\"\n  >\n  </mat-header-row>\n  <mat-row\n    mat-row\n    cdkDrag\n    *matRowDef=\"let row; columns: columnsToDispaly\"\n    class=\"gap-1 header-border-left\"\n  ></mat-row>\n  <!-- Footer for tabel -->\n  <ng-container *ngIf=\"footerShow\">\n    <mat-footer-row\n      [class]=\"footerMessageClass\"\n      *matFooterRowDef=\"columnsToDispaly\"\n      [attr.colspan]=\"columnsToDispaly.length\"\n    >\n    </mat-footer-row>\n  </ng-container>\n\n  <!--  Extanble-->\n  <ng-container *ngIf=\"extensible\">\n    <ng-container matColumnDef=\"extensibleData\">\n      <mat-cell\n        *matCellDef=\"let element\"\n        [attr.colspan]=\"columnsToDispaly.length\"\n        class=\"overflow-hidden\"\n      >\n        <div\n          [@detailExpand]=\"\n            element === (extandble$ | async) ? 'expanded' : 'collapsed'\n          \"\n          class=\"elix__table\"\n        >\n          <ng-container\n            *ngTemplateOutlet=\"\n              newElementExtandble;\n              context: { $implicit: element }\n            \"\n          >\n          </ng-container>\n        </div>\n      </mat-cell>\n    </ng-container>\n\n    <mat-row\n      *matRowDef=\"let row; columns: ['extensibleData']\"\n      class=\"example-detail-row gap-1 header-border-left\"\n    ></mat-row>\n  </ng-container>\n</mat-table>\n<div class=\"new\" *ngIf=\"addedNewEntry\" (click)=\"addNewEntry()\">\n  <mat-icon\n    [svgIcon]=\"'fa_solid:circle-plus'\"\n    class=\"new-entry\"\n  ></mat-icon>\n  <div>\n    <p>Added new Entry</p>\n  </div>\n\n</div>\n<mat-paginator\n  [class]=\"paginationClass\"\n  *ngIf=\"showPagination\"\n  (page)=\"changePage($event)\"\n  [length]=\"lenghtPagination\"\n  [pageSizeOptions]=\"[10, 20, 50]\"\n  showFirstLastButtons\n  aria-label=\"Select page of periodic elements\"\n>\n</mat-paginator>\n", styles: ["elix-table{transition:all .5s ease-in}elix-table mat-table{color:transparent;border-collapse:collapse;border-radius:.5rem;overflow:hidden;box-shadow:#00000026 0 15px 25px,#0000000d 0 5px 10px}elix-table .header-border-left{border-left:1px solid}elix-table mat-header-row mat-header-cell{justify-content:flex-start;border-spacing:2rem}elix-table mat-row{box-shadow:#0366d64d 0 0 0 3px;transition:all ease-in-out .1s;min-height:32px;border:.2px solid;position:relative;height:max-content}elix-table mat-row textarea{outline:none}elix-table mat-row:hover{background:rgba(1,1,222,.1)}elix-table mat-row mat-cell{justify-content:flex-start;position:relative;min-height:1rem;color:#000}elix-table mat-row mat-cell mat-form-field div{padding:0!important;border:0!important}elix-table mat-row mat-cell mat-form-field div input{border:1px solid;box-shadow:inset 0 0 3px 1px #00f3}elix-table mat-row mat-cell textarea{background:inherit;height:1.95rem}elix-table mat-row mat-cell textarea:focus-visible{outline:none;border:1px solid var(--primary-color-input)}elix-table mat-row mat-cell button{padding:0!important;min-width:auto!important}elix-table mat-header-row{min-height:1.5rem}elix-table mat-header-row mat-header-cell{min-height:inherit}elix-table mat-header-cell{color:#fff!important}elix-table .header-color{background:#2d333b;z-index:99!important}elix-table .mat-form-field-infix{width:auto}elix-table .example-detail-row{min-height:0!important}elix-table .example-detail-row mat-cell{min-height:inherit}elix-table .example-detail-row mat-cell .mat-form-field-infix{width:auto!important}.cdk-drop-list-dragging .cdk-drag{transition:transform .35s cubic-bezier(0,0,.2,1)}.cdk-drag-preview{z-index:200;background-color:#fff;border:1px solid #5f7651;box-shadow:#32325d40 0 6px 12px -2px,#0000004d 0 3px 7px -3px}.cdk-drag-animating{transition:transform .35s cubic-bezier(0,0,.2,1)}.new{display:flex;align-items:center;padding:1rem 0 1rem .5rem}.new-entry{color:#52796f!important;padding-right:.5rem}\n"], dependencies: [{ kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i3.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "directive", type: i3.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { kind: "component", type: i4.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { kind: "component", type: i5.MatTable, selector: "mat-table, table[mat-table]", exportAs: ["matTable"] }, { kind: "directive", type: i5.MatHeaderRowDef, selector: "[matHeaderRowDef]", inputs: ["matHeaderRowDef", "matHeaderRowDefSticky"] }, { kind: "directive", type: i5.MatColumnDef, selector: "[matColumnDef]", inputs: ["sticky", "matColumnDef"] }, { kind: "directive", type: i5.MatCellDef, selector: "[matCellDef]" }, { kind: "directive", type: i5.MatRowDef, selector: "[matRowDef]", inputs: ["matRowDefColumns", "matRowDefWhen"] }, { kind: "directive", type: i5.MatFooterRowDef, selector: "[matFooterRowDef]", inputs: ["matFooterRowDef", "matFooterRowDefSticky"] }, { kind: "directive", type: i5.MatCell, selector: "mat-cell, td[mat-cell]" }, { kind: "component", type: i5.MatHeaderRow, selector: "mat-header-row, tr[mat-header-row]", exportAs: ["matHeaderRow"] }, { kind: "component", type: i5.MatRow, selector: "mat-row, tr[mat-row]", exportAs: ["matRow"] }, { kind: "component", type: i5.MatFooterRow, selector: "mat-footer-row, tr[mat-footer-row]", exportAs: ["matFooterRow"] }, { kind: "component", type: i6.MatPaginator, selector: "mat-paginator", inputs: ["disabled"], exportAs: ["matPaginator"] }, { kind: "directive", type: i7.CdkDropList, selector: "[cdkDropList], cdk-drop-list", inputs: ["cdkDropListConnectedTo", "cdkDropListData", "cdkDropListOrientation", "id", "cdkDropListLockAxis", "cdkDropListDisabled", "cdkDropListSortingDisabled", "cdkDropListEnterPredicate", "cdkDropListSortPredicate", "cdkDropListAutoScrollDisabled", "cdkDropListAutoScrollStep"], outputs: ["cdkDropListDropped", "cdkDropListEntered", "cdkDropListExited", "cdkDropListSorted"], exportAs: ["cdkDropList"] }, { kind: "directive", type: i7.CdkDrag, selector: "[cdkDrag]", inputs: ["cdkDragData", "cdkDragLockAxis", "cdkDragRootElement", "cdkDragBoundary", "cdkDragStartDelay", "cdkDragFreeDragPosition", "cdkDragDisabled", "cdkDragConstrainPosition", "cdkDragPreviewClass", "cdkDragPreviewContainer"], outputs: ["cdkDragStarted", "cdkDragReleased", "cdkDragEnded", "cdkDragEntered", "cdkDragExited", "cdkDragDropped", "cdkDragMoved"], exportAs: ["cdkDrag"] }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }], animations: [
        trigger('detailExpand', [
            state('collapsed', style({
                height: '0px',
                minHeight: '0'
            })),
            state('expanded', style({ height: '*' })),
            transition('expanded <=> collapsed', animate('225ms cubic-bezier(0.4, 0.0, 0.2, 1)')),
        ]),
    ], encapsulation: i0.ViewEncapsulation.None });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.3.0", ngImport: i0, type: TableComponent, decorators: [{
            type: Component,
            args: [{ selector: 'elix-table', animations: [
                        trigger('detailExpand', [
                            state('collapsed', style({
                                height: '0px',
                                minHeight: '0'
                            })),
                            state('expanded', style({ height: '*' })),
                            transition('expanded <=> collapsed', animate('225ms cubic-bezier(0.4, 0.0, 0.2, 1)')),
                        ]),
                    ], encapsulation: ViewEncapsulation.None, template: "<mat-table mat-table [dataSource]=\"dataSource\" multiTemplateDataRows=\"true\" cdkDropList [cdkDropListData]=\"dataSource\"\n           [ngStyle]=\"{'box-shadow': addedNewEntry ? 'none': ''}\"\n           (cdkDropListDropped)=\"drop($event)\">\n  <ng-content></ng-content>\n  <mat-header-row\n    class=\"header-color gap-1\"\n    mat-header-row\n    *matHeaderRowDef=\"columnsToDispaly; sticky: true\"\n  >\n  </mat-header-row>\n  <mat-row\n    mat-row\n    cdkDrag\n    *matRowDef=\"let row; columns: columnsToDispaly\"\n    class=\"gap-1 header-border-left\"\n  ></mat-row>\n  <!-- Footer for tabel -->\n  <ng-container *ngIf=\"footerShow\">\n    <mat-footer-row\n      [class]=\"footerMessageClass\"\n      *matFooterRowDef=\"columnsToDispaly\"\n      [attr.colspan]=\"columnsToDispaly.length\"\n    >\n    </mat-footer-row>\n  </ng-container>\n\n  <!--  Extanble-->\n  <ng-container *ngIf=\"extensible\">\n    <ng-container matColumnDef=\"extensibleData\">\n      <mat-cell\n        *matCellDef=\"let element\"\n        [attr.colspan]=\"columnsToDispaly.length\"\n        class=\"overflow-hidden\"\n      >\n        <div\n          [@detailExpand]=\"\n            element === (extandble$ | async) ? 'expanded' : 'collapsed'\n          \"\n          class=\"elix__table\"\n        >\n          <ng-container\n            *ngTemplateOutlet=\"\n              newElementExtandble;\n              context: { $implicit: element }\n            \"\n          >\n          </ng-container>\n        </div>\n      </mat-cell>\n    </ng-container>\n\n    <mat-row\n      *matRowDef=\"let row; columns: ['extensibleData']\"\n      class=\"example-detail-row gap-1 header-border-left\"\n    ></mat-row>\n  </ng-container>\n</mat-table>\n<div class=\"new\" *ngIf=\"addedNewEntry\" (click)=\"addNewEntry()\">\n  <mat-icon\n    [svgIcon]=\"'fa_solid:circle-plus'\"\n    class=\"new-entry\"\n  ></mat-icon>\n  <div>\n    <p>Added new Entry</p>\n  </div>\n\n</div>\n<mat-paginator\n  [class]=\"paginationClass\"\n  *ngIf=\"showPagination\"\n  (page)=\"changePage($event)\"\n  [length]=\"lenghtPagination\"\n  [pageSizeOptions]=\"[10, 20, 50]\"\n  showFirstLastButtons\n  aria-label=\"Select page of periodic elements\"\n>\n</mat-paginator>\n", styles: ["elix-table{transition:all .5s ease-in}elix-table mat-table{color:transparent;border-collapse:collapse;border-radius:.5rem;overflow:hidden;box-shadow:#00000026 0 15px 25px,#0000000d 0 5px 10px}elix-table .header-border-left{border-left:1px solid}elix-table mat-header-row mat-header-cell{justify-content:flex-start;border-spacing:2rem}elix-table mat-row{box-shadow:#0366d64d 0 0 0 3px;transition:all ease-in-out .1s;min-height:32px;border:.2px solid;position:relative;height:max-content}elix-table mat-row textarea{outline:none}elix-table mat-row:hover{background:rgba(1,1,222,.1)}elix-table mat-row mat-cell{justify-content:flex-start;position:relative;min-height:1rem;color:#000}elix-table mat-row mat-cell mat-form-field div{padding:0!important;border:0!important}elix-table mat-row mat-cell mat-form-field div input{border:1px solid;box-shadow:inset 0 0 3px 1px #00f3}elix-table mat-row mat-cell textarea{background:inherit;height:1.95rem}elix-table mat-row mat-cell textarea:focus-visible{outline:none;border:1px solid var(--primary-color-input)}elix-table mat-row mat-cell button{padding:0!important;min-width:auto!important}elix-table mat-header-row{min-height:1.5rem}elix-table mat-header-row mat-header-cell{min-height:inherit}elix-table mat-header-cell{color:#fff!important}elix-table .header-color{background:#2d333b;z-index:99!important}elix-table .mat-form-field-infix{width:auto}elix-table .example-detail-row{min-height:0!important}elix-table .example-detail-row mat-cell{min-height:inherit}elix-table .example-detail-row mat-cell .mat-form-field-infix{width:auto!important}.cdk-drop-list-dragging .cdk-drag{transition:transform .35s cubic-bezier(0,0,.2,1)}.cdk-drag-preview{z-index:200;background-color:#fff;border:1px solid #5f7651;box-shadow:#32325d40 0 6px 12px -2px,#0000004d 0 3px 7px -3px}.cdk-drag-animating{transition:transform .35s cubic-bezier(0,0,.2,1)}.new{display:flex;align-items:center;padding:1rem 0 1rem .5rem}.new-entry{color:#52796f!important;padding-right:.5rem}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.TableService }, { type: i2.ColumnRotateService }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { dataSource: [{
                type: Input
            }], extensible: [{
                type: Input
            }], extandble$: [{
                type: Input
            }], footerShow: [{
                type: Input
            }], footerMessageClass: [{
                type: Input
            }], newElementExtandble: [{
                type: Input
            }], showPagination: [{
                type: Input
            }], lenghtPagination: [{
                type: Input
            }], paginationClass: [{
                type: Input
            }], addedNewEntry: [{
                type: Input
            }], onAddEntry: [{
                type: Output
            }], onPaginationChange: [{
                type: Output
            }], filterTooltip: [{
                type: Input
            }], table: [{
                type: ViewChild,
                args: [MatTable, { static: true }]
            }], paginator: [{
                type: ViewChild,
                args: [MatPaginator]
            }], columnDefs: [{
                type: ContentChildren,
                args: [BaseColumn]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWxpYnVyZy9zcmMvbGliL3RhYmxlL3RhYmxlL3RhYmxlLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1saWJ1cmcvc3JjL2xpYi90YWJsZS90YWJsZS90YWJsZS5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsT0FBTyxFQUNQLEtBQUssRUFDTCxLQUFLLEVBQ0wsVUFBVSxFQUNWLE9BQU8sRUFDUixNQUFNLHFCQUFxQixDQUFDO0FBQzdCLE9BQU8sRUFBZSxlQUFlLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN0RSxPQUFPLEVBR0wsU0FBUyxFQUNULGVBQWUsRUFDZixZQUFZLEVBQ1osS0FBSyxFQUVMLE1BQU0sRUFHTixTQUFTLEVBQ1QsaUJBQWlCLEVBQ2xCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxZQUFZLEVBQWEsTUFBTSw2QkFBNkIsQ0FBQztBQUN0RSxPQUFPLEVBQWdCLFFBQVEsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ2pFLE9BQU8sRUFBbUIsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2hELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzQyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7OztBQThDNUMsTUFBTSxPQUFPLGNBQWM7SUFrRXpCLFlBQ21CLFdBQXlCLEVBQ3pCLGFBQWtDLEVBQ2xDLGtCQUFxQztRQUZyQyxnQkFBVyxHQUFYLFdBQVcsQ0FBYztRQUN6QixrQkFBYSxHQUFiLGFBQWEsQ0FBcUI7UUFDbEMsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFtQjtRQS9EakQsZUFBVSxHQUFZLEtBQUssQ0FBQztRQU1uQyxTQUFTO1FBRUYs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YyxFQUFFOzRCQUN0QixLQUFLLENBQ0gsV0FBVyxFQUNYLEtBQUssQ0FBQztnQ0FDSixNQUFNLEVBQUUsS0FBSztnQ0FDYixTQUFTLEVBQUUsR0FBRzs2QkFDZixDQUFDLENBQUM7NEJBQ0wsS0FBSyxDQUNILFVBQVUsRUFDVixLQUFLLENBQUMsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQzs0QkFDekIsVUFBVSxDQUNSLHdCQUF3QixFQUN4QixPQUFPLENBQ0wsc0NBQXNDLENBQUMsQ0FDMUM7eUJBQ0YsQ0FBQztxQkFDSCxpQkFDYyxpQkFBaUIsQ0FBQyxJQUFJO3FLQUs5QixVQUFVO3NCQUZoQixLQUFLO2dCQUtDLFVBQVU7c0JBRGhCLEtBQUs7Z0JBS0MsVUFBVTtzQkFGaEIsS0FBSztnQkFNQyxVQUFVO3NCQURoQixLQUFLO2dCQUtDLGtCQUFrQjtzQkFEeEIsS0FBSztnQkFNQyxtQkFBbUI7c0JBRnpCLEtBQUs7Z0JBTUMsY0FBYztzQkFEcEIsS0FBSztnQkFNQyxnQkFBZ0I7c0JBRnRCLEtBQUs7Z0JBTUMsZUFBZTtzQkFGckIsS0FBSztnQkFLQyxhQUFhO3NCQURuQixLQUFLO2dCQUdXLFVBQVU7c0JBQTFCLE1BQU07Z0JBRVUsa0JBQWtCO3NCQUFsQyxNQUFNO2dCQUtQLGFBQWE7c0JBRFosS0FBSztnQkFJaUMsS0FBSztzQkFBM0MsU0FBUzt1QkFBQyxRQUFRLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO2dCQUdaLFNBQVM7c0JBQWpDLFNBQVM7dUJBQUMsWUFBWTtnQkFLaEIsVUFBVTtzQkFIaEIsZUFBZTt1QkFBQyxVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgYW5pbWF0ZSxcbiAgc3RhdGUsXG4gIHN0eWxlLFxuICB0cmFuc2l0aW9uLFxuICB0cmlnZ2VyXG59IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHsgQ2RrRHJhZ0Ryb3AsIG1vdmVJdGVtSW5BcnJheSB9IGZyb20gXCJAYW5ndWxhci9jZGsvZHJhZy1kcm9wXCI7XG5pbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgT3V0cHV0LFxuICBRdWVyeUxpc3QsXG4gIFRlbXBsYXRlUmVmLFxuICBWaWV3Q2hpbGQsXG4gIFZpZXdFbmNhcHN1bGF0aW9uXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWF0UGFnaW5hdG9yLCBQYWdlRXZlbnQgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9wYWdpbmF0b3InO1xuaW1wb3J0IHsgTWF0Q29sdW1uRGVmLCBNYXRUYWJsZSB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3RhYmxlJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQmFzZUNvbHVtbiB9IGZyb20gJy4uL2Jhc2UtY29sdW1uJztcbmltcG9ydCB7IENvbHVtblJvdGF0ZVNlcnZpY2UgfSBmcm9tIFwiLi4vY29sdW1ucy9zZXJ2aWNlL2NvbHVtbi1yb3RhdGUuc2VydmljZVwiO1xuaW1wb3J0IHsgVGFibGVTZXJ2aWNlIH0gZnJvbSBcIi4vdGFibGUuc2VydmljZVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIElBY3Rpb25NYXRlcmlhbENvbHVtbiB7XG4gIGljb25DbGFzczogc3RyaW5nO1xuXG4gIGNsYXNzQ3NzOiBzdHJpbmc7XG5cbiAgbWV0aG9kOiAocm93PzogYW55KSA9PiB2b2lkO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIERhdGFTb3VyY2VNYXRlcmlhbFRhYmxlPFQ+IHtcbiAgbW9kZWw6IFQ7XG5cbiAgZWRpdGFibGU6IGJvb2xlYW47XG5cbiAgYWN0aW9uczogSUFjdGlvbk1hdGVyaWFsQ29sdW1uW107XG5cbiAgaWQ/OiBudW1iZXI7XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2VsaXgtdGFibGUnLFxuICB0ZW1wbGF0ZVVybDogJy4vdGFibGUuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsgJy4vdGFibGUuY29tcG9uZW50LnNjc3MnIF0sXG4gIGFuaW1hdGlvbnM6IFtcbiAgICB0cmlnZ2VyKCdkZXRhaWxFeHBhbmQnLCBbXG4gICAgICBzdGF0ZShcbiAgICAgICAgJ2NvbGxhcHNlZCcsXG4gICAgICAgIHN0eWxlKHtcbiAgICAgICAgICBoZWlnaHQ6ICcwcHgnLFxuICAgICAgICAgIG1pbkhlaWdodDogJzAnXG4gICAgICAgIH0pKSxcbiAgICAgIHN0YXRlKFxuICAgICAgICAnZXhwYW5kZWQnLFxuICAgICAgICBzdHlsZSh7IGhlaWdodDogJyonIH0pKSxcbiAgICAgIHRyYW5zaXRpb24oXG4gICAgICAgICdleHBhbmRlZCA8PT4gY29sbGFwc2VkJyxcbiAgICAgICAgYW5pbWF0ZShcbiAgICAgICAgICAnMjI1bXMgY3ViaWMtYmV6aWVyKDAuNCwgMC4wLCAwLjIsIDEpJyksXG4gICAgICApLFxuICAgIF0pLFxuICBdLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxufSlcbmV4cG9ydCBjbGFzcyBUYWJsZUNvbXBvbmVudDxUPiBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG4gIEBJbnB1dCgpXG4gIC8vIEB0cy1pZ25vcmVcbiAgcHVibGljIGRhdGFTb3VyY2U6IEFycmF5PERhdGFTb3VyY2VNYXRlcmlhbFRhYmxlPFQ+PjtcblxuICBASW5wdXQoKVxuICBwdWJsaWMgZXh0ZW5zaWJsZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIEBJbnB1dCgpXG4gIC8vIEB0cy1pZ25vcmVcbiAgcHVibGljIGV4dGFuZGJsZSQ6IEJlaGF2aW9yU3ViamVjdDxEYXRhU291cmNlTWF0ZXJpYWxUYWJsZTxUPiB8IG51bGw+O1xuXG4gIC8vIEZvb3RlclxuICBASW5wdXQoKVxuICBwdWJsaWMgZm9vdGVyU2hvdzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8vIGNsYXNzIGZvciBmb290ZXJcbiAgQElucHV0KClcbiAgcHVibGljIGZvb3Rlck1lc3NhZ2VDbGFzczogc3RyaW5nID0gJyc7XG5cbiAgLy8gbmV3IHRhYmxlIGluIHJvd1xuICBASW5wdXQoKVxuICAvLyBAdHMtaWdub3JlXG4gIHB1YmxpYyBuZXdFbGVtZW50RXh0YW5kYmxlOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gIC8vIGZsYWcgYWJvdXQgaWYgd2Ugd2FudCB0byBzaG93IHBhZ2luYXRpb25cbiAgQElucHV0KClcbiAgcHVibGljIHNob3dQYWdpbmF0aW9uOiBib29sZWFuID0gZmFsc2U7XG5cbiAgLy8gbnVtYmVyT2YgRW50cnlcbiAgQElucHV0KClcbiAgLy8gQHRzLWlnbm9yZVxuICBwdWJsaWMgbGVuZ2h0UGFnaW5hdGlvbjogbnVtYmVyO1xuXG4gIEBJbnB1dCgpXG4gIC8vIEB0cy1pZ25vcmVcbiAgcHVibGljIHBhZ2luYXRpb25DbGFzczogc3RyaW5nO1xuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBhZGRlZE5ld0VudHJ5ID0gZmFsc2U7XG5cbiAgQE91dHB1dCgpIHB1YmxpYyBvbkFkZEVudHJ5OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIEBPdXRwdXQoKSBwdWJsaWMgb25QYWdpbmF0aW9uQ2hhbmdlOiBFdmVudEVtaXR0ZXI8UGFnZUV2ZW50PiA9XG4gICAgbmV3IEV2ZW50RW1pdHRlcjxQYWdlRXZlbnQ+KCk7XG5cblxuICBASW5wdXQoKVxuICBmaWx0ZXJUb29sdGlwOiBib29sZWFuID0gdHJ1ZTtcbiAgLy8gdGhpcyBpcyB3aGVyZSB0aGUgbWFnaWMgaGFwcGVuczpcbiAgLy8gQHRzLWlnbm9yZVxuICBAVmlld0NoaWxkKE1hdFRhYmxlLCB7IHN0YXRpYzogdHJ1ZSB9KSB0YWJsZTogTWF0VGFibGU8VD47XG5cbiAgLy8gQHRzLWlnbm9yZVxuICBAVmlld0NoaWxkKE1hdFBhZ2luYXRvcikgcGFnaW5hdG9yOiBNYXRQYWdpbmF0b3I7XG5cbiAgQENvbnRlbnRDaGlsZHJlbihCYXNlQ29sdW1uKVxuICAvLyBAdHMtaWdub3JlXG4gIC8vIGFmdGVyIHRoZSA8bmctY29udGVudD4gaGFzIGJlZW4gaW5pdGlhbGl6ZWQsIHRoZSBjb2x1bW4gZGVmaW5pdGlvbnMgYXJlIGF2YWlsYWJsZS5cbiAgcHVibGljIGNvbHVtbkRlZnM6IFF1ZXJ5TGlzdDxCYXNlQ29sdW1uPjtcbiAgcHVibGljIGNvbHVtbnNUb0Rpc3BhbHk6IHN0cmluZ1tdID0gW107XG5cbiAgcHJpdmF0ZSBkb3VibGVDb2x1bW5Ub0Rpc3BsYXk6IHN0cmluZ1tdID0gW107XG4gIC8vIGZvciBhdm9pZCBtZW1vcnkgbGVha1xuICBwcml2YXRlIF9kZXN0cm95ZWQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgX3RhYmxlU3RhdGU6IFRhYmxlU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9jb2x1bW5Sb3RhdGU6IENvbHVtblJvdGF0ZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBfY2hhbmdlRGV0ZWN0b3JSZWY6IENoYW5nZURldGVjdG9yUmVmLFxuICApe1xuICB9XG5cbiAgcHVibGljIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lke1xuICAgIHRoaXMuY29sdW1uc1RvRGlzcGFseSA9IHRoaXMuY29sdW1uRGVmcy5tYXAoXG4gICAgICAocmVzcDogQmFzZUNvbHVtbikgPT4gcmVzcC5jb2x1bW5EZWYubmFtZSxcbiAgICApO1xuICAgIHRoaXMuY29sdW1uRGVmc1xuICAgICAgLm1hcCgocmVzcDogQmFzZUNvbHVtbikgPT4gcmVzcC5jb2x1bW5EZWYpXG4gICAgICAuZm9yRWFjaCgocmVwOiBNYXRDb2x1bW5EZWYpID0+IHRoaXMudGFibGUuYWRkQ29sdW1uRGVmKFxuICAgICAgICByZXApKTtcbiAgICB0aGlzLl9jb2x1bW5Sb3RhdGUucm90YXRlJC5waXBlKHRha2VVbnRpbCh0aGlzLl9kZXN0cm95ZWQpKS5zdWJzY3JpYmUoKHNpZGU6IHN0cmluZykgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBzaWRlLmluY2x1ZGVzKCdsZWZ0JylcbiAgICAgICkge1xuICAgICAgICB0aGlzLnJvdGF0ZUNvbHVtbignbGVmdCcpO1xuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnJvdGF0ZUNvbHVtbigncmlnaHQnKTtcbiAgICAgIH1cbiAgICB9KVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBkdXBsaWNhdGUgPSB0aGlzLmNvbHVtbnNUb0Rpc3BhbHkuZmlsdGVyKFxuICAgICAgICAoXG4gICAgICAgICAgY29sdW1uRGlzcGxheTogc3RyaW5nLFxuICAgICAgICAgIGluZGV4OiBudW1iZXIsXG4gICAgICAgICAgc2VsZjogc3RyaW5nW10pID0+XG4gICAgICAgICAgaW5kZXggPT09IHNlbGYuZmluZEluZGV4KCh2YWx1ZTogc3RyaW5nKSA9PiB2YWx1ZSA9PT0gY29sdW1uRGlzcGxheSksXG4gICAgICApO1xuICAgICAgdGhpcy5kb3VibGVDb2x1bW5Ub0Rpc3BsYXkgPSB0aGlzLmNvbHVtbnNUb0Rpc3BhbHk7XG4gICAgICB0aGlzLl9zZXRDb2x1bW5Gb3JMYXlvdXQoKTtcbiAgICAgIGlmICggZHVwbGljYXRlLmxlbmd0aCA8IHRoaXMuY29sdW1uc1RvRGlzcGFseS5sZW5ndGggKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnWW91IGR1cGxpY2F0ZSB2YWx1ZSB3aGF0IHlvdSB3YW50IHRvIGRpc3BsYXksIFBsZWFzZSBsb29rIGluIGRlZmluaXRpb25zIGF0IGNvbHVtbnMnLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKCBlcnIgKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfVxuICAgIHRoaXMuX2NoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuXG4gIHB1YmxpYyBhZGROZXdFbnRyeSgpe1xuICAgIHRoaXMub25BZGRFbnRyeS5uZXh0KHRydWUpO1xuICB9XG5cbiAgcHVibGljIGNoYW5nZVBhZ2UoZXZlbnQ6IFBhZ2VFdmVudCl7XG4gICAgdGhpcy5vblBhZ2luYXRpb25DaGFuZ2UuZW1pdChldmVudCk7XG4gIH1cblxuICBwdWJsaWMgZHJvcChldmVudDogQ2RrRHJhZ0Ryb3A8QXJyYXk8RGF0YVNvdXJjZU1hdGVyaWFsVGFibGU8VD4+Pik6IHZvaWR7XG4gICAgbW92ZUl0ZW1JbkFycmF5KFxuICAgICAgdGhpcy5kYXRhU291cmNlLFxuICAgICAgZXZlbnQucHJldmlvdXNJbmRleCxcbiAgICAgIGV2ZW50LmN1cnJlbnRJbmRleCk7XG4gICAgdGhpcy50YWJsZS5yZW5kZXJSb3dzKCk7XG4gIH1cblxuICBwcml2YXRlIHJvdGF0ZUNvbHVtbihzaWRlOiBzdHJpbmcpe1xuICAgIGlmICggc2lkZSA9PT0gJ2xlZnQnICkge1xuICAgICAgdGhpcy5fcm90YXRlTGVmdCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9yb3RhdGVSaWdodCgpO1xuICAgIH1cbiAgICB0aGlzLmNvbHVtbnNUb0Rpc3BhbHkgPSBbIC4uLnRoaXMuZG91YmxlQ29sdW1uVG9EaXNwbGF5LnNsaWNlKFxuICAgICAgMCxcbiAgICAgIHRoaXMuY29sdW1uc1RvRGlzcGFseS5sZW5ndGggLSAxKSwgJ2FjdGlvbicgXVxuICB9XG5cbiAgcHJpdmF0ZSBfcm90YXRlTGVmdCgpe1xuICAgIGNvbnN0IGludGVybWVkaWF0ZUNvbHVtbiA9IHRoaXMuZG91YmxlQ29sdW1uVG9EaXNwbGF5WyAwIF1cbiAgICB0aGlzLmRvdWJsZUNvbHVtblRvRGlzcGxheS5mb3JFYWNoKChjb2x1bW4sIGluZGV4KSA9PiB7XG4gICAgICB0aGlzLmRvdWJsZUNvbHVtblRvRGlzcGxheVsgaW5kZXggXSA9IHRoaXMuZG91YmxlQ29sdW1uVG9EaXNwbGF5WyBpbmRleCArIDEgXVxuICAgIH0pXG4gICAgdGhpcy5kb3VibGVDb2x1bW5Ub0Rpc3BsYXlbIHRoaXMuZG91YmxlQ29sdW1uVG9EaXNwbGF5Lmxlbmd0aCAtIDEgXSA9IGludGVybWVkaWF0ZUNvbHVtblxuICAgIHRoaXMuX2NvbHVtblJvdGF0ZS5zd2FwQ29sdW1uKHRoaXMuZG91YmxlQ29sdW1uVG9EaXNwbGF5KTtcbiAgfVxuXG4gIHByaXZhdGUgX3JvdGF0ZVJpZ2h0KCl7XG4gICAgY29uc3QgaW50ZXJtZWRpYXRlQ29sdW1uID0gdGhpcy5kb3VibGVDb2x1bW5Ub0Rpc3BsYXlbIHRoaXMuZG91YmxlQ29sdW1uVG9EaXNwbGF5Lmxlbmd0aCAtIDIgXVxuICAgIGZvciAoIGxldCBpID0gdGhpcy5kb3VibGVDb2x1bW5Ub0Rpc3BsYXkubGVuZ3RoIC0gMjsgaSA+IDA7IGktLSApIHtcbiAgICAgIHRoaXMuZG91YmxlQ29sdW1uVG9EaXNwbGF5WyBpIF0gPSB0aGlzLmRvdWJsZUNvbHVtblRvRGlzcGxheVsgaSAtIDEgXVxuICAgIH1cbiAgICB0aGlzLmRvdWJsZUNvbHVtblRvRGlzcGxheVsgMCBdID0gaW50ZXJtZWRpYXRlQ29sdW1uXG4gIH1cblxuXG4gIHByaXZhdGUgX3NldENvbHVtbkZvckxheW91dCgpe1xuICAgIHRoaXMuX3RhYmxlU3RhdGUucmVzcG9uc2l2ZSh0aGlzLmNvbHVtbnNUb0Rpc3BhbHksIHRoaXMuZG91YmxlQ29sdW1uVG9EaXNwbGF5KVxuICAgIHRoaXMuX3RhYmxlU3RhdGUuY29sdW1uRGlzcGxheSQucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveWVkKSkuc3Vic2NyaWJlKFxuICAgICAgY29sdW1ucyA9PiB7XG4gICAgICAgIHRoaXMuY29sdW1uc1RvRGlzcGFseSA9IGNvbHVtbnNcbiAgICAgIH0pXG4gIH1cblxuICBwdWJsaWMgbmdPbkRlc3Ryb3koKXtcbiAgICB0aGlzLl9kZXN0cm95ZWQubmV4dCgpO1xuICAgIHRoaXMuX2Rlc3Ryb3llZC5jb21wbGV0ZSgpO1xuICB9XG59XG4iLCI8bWF0LXRhYmxlIG1hdC10YWJsZSBbZGF0YVNvdXJjZV09XCJkYXRhU291cmNlXCIgbXVsdGlUZW1wbGF0ZURhdGFSb3dzPVwidHJ1ZVwiIGNka0Ryb3BMaXN0IFtjZGtEcm9wTGlzdERhdGFdPVwiZGF0YVNvdXJjZVwiXG4gICAgICAgICAgIFtuZ1N0eWxlXT1cInsnYm94LXNoYWRvdyc6IGFkZGVkTmV3RW50cnkgPyAnbm9uZSc6ICcnfVwiXG4gICAgICAgICAgIChjZGtEcm9wTGlzdERyb3BwZWQpPVwiZHJvcCgkZXZlbnQpXCI+XG4gIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cbiAgPG1hdC1oZWFkZXItcm93XG4gICAgY2xhc3M9XCJoZWFkZXItY29sb3IgZ2FwLTFcIlxuICAgIG1hdC1oZWFkZXItcm93XG4gICAgKm1hdEhlYWRlclJvd0RlZj1cImNvbHVtbnNUb0Rpc3BhbHk7IHN0aWNreTogdHJ1ZVwiXG4gID5cbiAgPC9tYXQtaGVhZGVyLXJvdz5cbiAgPG1hdC1yb3dcbiAgICBtYXQtcm93XG4gICAgY2RrRHJhZ1xuICAgICptYXRSb3dEZWY9XCJsZXQgcm93OyBjb2x1bW5zOiBjb2x1bW5zVG9EaXNwYWx5XCJcbiAgICBjbGFzcz1cImdhcC0xIGhlYWRlci1ib3JkZXItbGVmdFwiXG4gID48L21hdC1yb3c+XG4gIDwhLS0gRm9vdGVyIGZvciB0YWJlbCAtLT5cbiAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImZvb3RlclNob3dcIj5cbiAgICA8bWF0LWZvb3Rlci1yb3dcbiAgICAgIFtjbGFzc109XCJmb290ZXJNZXNzYWdlQ2xhc3NcIlxuICAgICAgKm1hdEZvb3RlclJvd0RlZj1cImNvbHVtbnNUb0Rpc3BhbHlcIlxuICAgICAgW2F0dHIuY29sc3Bhbl09XCJjb2x1bW5zVG9EaXNwYWx5Lmxlbmd0aFwiXG4gICAgPlxuICAgIDwvbWF0LWZvb3Rlci1yb3c+XG4gIDwvbmctY29udGFpbmVyPlxuXG4gIDwhLS0gIEV4dGFuYmxlLS0+XG4gIDxuZy1jb250YWluZXIgKm5nSWY9XCJleHRlbnNpYmxlXCI+XG4gICAgPG5nLWNvbnRhaW5lciBtYXRDb2x1bW5EZWY9XCJleHRlbnNpYmxlRGF0YVwiPlxuICAgICAgPG1hdC1jZWxsXG4gICAgICAgICptYXRDZWxsRGVmPVwibGV0IGVsZW1lbnRcIlxuICAgICAgICBbYXR0ci5jb2xzcGFuXT1cImNvbHVtbnNUb0Rpc3BhbHkubGVuZ3RoXCJcbiAgICAgICAgY2xhc3M9XCJvdmVyZmxvdy1oaWRkZW5cIlxuICAgICAgPlxuICAgICAgICA8ZGl2XG4gICAgICAgICAgW0BkZXRhaWxFeHBhbmRdPVwiXG4gICAgICAgICAgICBlbGVtZW50ID09PSAoZXh0YW5kYmxlJCB8IGFzeW5jKSA/ICdleHBhbmRlZCcgOiAnY29sbGFwc2VkJ1xuICAgICAgICAgIFwiXG4gICAgICAgICAgY2xhc3M9XCJlbGl4X190YWJsZVwiXG4gICAgICAgID5cbiAgICAgICAgICA8bmctY29udGFpbmVyXG4gICAgICAgICAgICAqbmdUZW1wbGF0ZU91dGxldD1cIlxuICAgICAgICAgICAgICBuZXdFbGVtZW50RXh0YW5kYmxlO1xuICAgICAgICAgICAgICBjb250ZXh0OiB7ICRpbXBsaWNpdDogZWxlbWVudCB9XG4gICAgICAgICAgICBcIlxuICAgICAgICAgID5cbiAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L21hdC1jZWxsPlxuICAgIDwvbmctY29udGFpbmVyPlxuXG4gICAgPG1hdC1yb3dcbiAgICAgICptYXRSb3dEZWY9XCJsZXQgcm93OyBjb2x1bW5zOiBbJ2V4dGVuc2libGVEYXRhJ11cIlxuICAgICAgY2xhc3M9XCJleGFtcGxlLWRldGFpbC1yb3cgZ2FwLTEgaGVhZGVyLWJvcmRlci1sZWZ0XCJcbiAgICA+PC9tYXQtcm93PlxuICA8L25nLWNvbnRhaW5lcj5cbjwvbWF0LXRhYmxlPlxuPGRpdiBjbGFzcz1cIm5ld1wiICpuZ0lmPVwiYWRkZWROZXdFbnRyeVwiIChjbGljayk9XCJhZGROZXdFbnRyeSgpXCI+XG4gIDxtYXQtaWNvblxuICAgIFtzdmdJY29uXT1cIidmYV9zb2xpZDpjaXJjbGUtcGx1cydcIlxuICAgIGNsYXNzPVwibmV3LWVudHJ5XCJcbiAgPjwvbWF0LWljb24+XG4gIDxkaXY+XG4gICAgPHA+QWRkZWQgbmV3IEVudHJ5PC9wPlxuICA8L2Rpdj5cblxuPC9kaXY+XG48bWF0LXBhZ2luYXRvclxuICBbY2xhc3NdPVwicGFnaW5hdGlvbkNsYXNzXCJcbiAgKm5nSWY9XCJzaG93UGFnaW5hdGlvblwiXG4gIChwYWdlKT1cImNoYW5nZVBhZ2UoJGV2ZW50KVwiXG4gIFtsZW5ndGhdPVwibGVuZ2h0UGFnaW5hdGlvblwiXG4gIFtwYWdlU2l6ZU9wdGlvbnNdPVwiWzEwLCAyMCwgNTBdXCJcbiAgc2hvd0ZpcnN0TGFzdEJ1dHRvbnNcbiAgYXJpYS1sYWJlbD1cIlNlbGVjdCBwYWdlIG9mIHBlcmlvZGljIGVsZW1lbnRzXCJcbj5cbjwvbWF0LXBhZ2luYXRvcj5cbiJdfQ==